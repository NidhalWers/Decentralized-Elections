{% extends "base/base.html" %}

{% block body %}
{% load static %}

<div id="Election">

    <div class="row">
        <nav aria-label="breadcrumb" class="d-flex justify-content-between">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">Administration des votes</li>
            </ol>
            <div>
                <a href="parametre" class=""><button type="button" class="btn btn-primary">Voir la liste des candidats</button></a>
                <a href="parametre"><button type="button" class="btn btn-primary">Créer une élection</button></a>
            </div>
            <!-- <p><em>[[currentDates]]</em></p> -->
        </nav> 
    </div>
    <div class="row pb-5 mt-0">
        <p class="h1 d-flex justify-content-center">Administration des votes</p>

        <p class="h6 d-flex justify-content-center">Créez et paramétrez les élections</p>
    </div>
    <div class="row">
        <p><em>Elections en cours</em></p>
        <div v-for="election in elections" v-if="(actualTime > election.ElectionStartDate && election.ElectionEndDate > actualTime)" class="col-lg-4">
            <div v-if="election.ElectionBlind" class="opacity-50">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>[[soustractionDate(election.ElectionEndDate,currentDates)]] restant</p>
                                </div>
                                <button type="button" v-on:click="redirectToElection(election.ElectionName,election.ElectionStatus)" class="btn btn-soft-primary">Voir l'élection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="!election.ElectionBlind">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>[[soustractionDate(election.ElectionEndDate,currentDates)]] restant</p>
                                </div>
                                <button type="button" v-on:click="redirectToElection(election.ElectionName,election.ElectionStatus)" class="btn btn-soft-primary">Voir l'élection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
    <hr>
    <div class="row">
        <p><em>Prochaines élections</em></p>
        <div v-for="election in elections" v-if="election.ElectionStartDate>actualTime" class="col-lg-4">
            <div v-if="election.ElectionBlind" class="opacity-50">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>Disponible dans [[soustractionDate(election.ElectionStartDate,currentDates)]]</p>
                                </div>
                                <button v-on:click="redirectToElection(election.ElectionName,election.ElectionStatus)" type="button" class="btn btn-soft-light">Voir l'élection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="!election.ElectionBlind">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>Disponible dans [[soustractionDate(election.ElectionStartDate,currentDates)]]</p>
                                </div>
                                <button v-on:click="redirectToElection(election.ElectionName,election.ElectionStatus)" type="button" class="btn btn-soft-light">Voir l'élection</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
    <hr>
    <div class="row">
        <p><em>Anciennes élections</em></p>
        <div v-for="election in elections" v-if="actualTime>election.ElectionEndDate" class="col-lg-4">
            <div v-if="election.ElectionBlind" class="opacity-50">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>Terminé depuis [[soustractionDate(currentDates,election.ElectionEndDate)]]</p>
                                </div>
                                <a href="/vote"><button type="button" class="btn btn-soft-success">Voir l'élection et les resultats</button></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="!election.ElectionBlind">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-center">
                            <div class="d-flex flex-column text-center align-items-center justify-content-between ">
                                <div class="fs-italic">
                                    <h5>[[election.ElectionName]]</h5><p><em>[[election.ElectionStatus]]</em></p>
                                </div>	
                                <div class="mt-1 text-center text-muted-50">
                                    <p>Terminé depuis [[soustractionDate(currentDates,election.ElectionEndDate)]]</p>
                                </div>
                                <a href="/vote"><button type="button" class="btn btn-soft-success">Voir l'élection et les resultats</button></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
</div>
<!-- vue:js -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
<!-- axios:js -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    var parametre = new Vue({
        delimiters: ['[[', ']]'],
        el: '#Election',
        data() {
                return {
                    actualTime:"",
                    currentDates:"",
                    elections:{}
                }
        },
        async mounted() {
            await this.getElections()
        },
        
        created() {
                setInterval(this.currentDate, 1000);
                setInterval(this.getElections, 1000);
            },

            
        methods: {
            getElections: async function () {
                await axios
                    .get('/adminspace/api/getElections')
                    .then(response => (this.elections = response.data))
                    .catch(response => (console.log(response.data)));
                    
            },

            currentDate: function() {
                const today = new Date();
                    const year = today.getFullYear();
                    const month = ('0'+today.getMonth()+1).slice(-2);
                    const day = ('0'+today.getDate()).slice(-2);
                    const hour = ('0'+today.getHours()).slice(-2);
                    const minute = ('0'+today.getMinutes()).slice(-2);
                    const second = ('0'+today.getSeconds()).slice(-2);
                    // const time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
                    // const date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+(today.getDate());
                    const dateTime = year +'-'+ month+'-'+day+'T'+hour+':'+minute+':'+second+'Z'; 
                    const currentDateTime = year +'-'+ month+'-'+day+' '+hour+':'+minute+':'+second;
                    // this.dateTime = moment(dateTime).format('YYYY-MM-DD[T]HH:mm:ss[Z]');
                    this.currentDates = currentDateTime;
                    this.actualTime = dateTime;
                },

            // Function diffenrece between two dates and return number of days, hours, minutes and seconds
            soustractionDate: function(date1, date2) {
                var date1 = new Date(date1);
                var date2 = new Date(date2);
                var diff = date1.getTime() - date2.getTime();
                var days = Math.floor(diff / (1000 * 60 * 60 * 24));
                var hours = Math.floor(diff / (1000 * 60 * 60));
                var minutes = Math.floor(diff / (1000 * 60));
                var seconds = Math.floor(diff / 1000);
                if (days > 0) {
                    return days + " jours";
                } else if (hours > 0) {
                    return hours + " heures";
                } else if (minutes > 0) {
                    return minutes + " minutes";
                } else if (seconds > 0) {
                    return seconds + " secondes";
                } else {
                    return "0 secondes";
                }
            },

            // Function to redirect to election page
            redirectToElection: function(electionName,electionStatus) {
                    if(electionStatus.length == 0){
                        window.location.href = "/adminspace/viewElection/"+electionName;
                    }else{
                        window.location.href = "/adminspace/viewElectionStatus/"+electionName+"/"+electionStatus;
                    }
                    
            },
        },
    });
</script>
{% endblock %}